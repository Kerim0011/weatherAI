<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Weather Assistant</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-2xl h-[80vh] flex flex-col">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-4">AI Weather Assistant</h1>
        <div class="flex-1 overflow-y-auto space-y-4 p-4 rounded-lg bg-gray-50 border border-gray-200" id="chat-messages">
            
        </div>
        
        <div class="mt-4 flex rounded-full shadow-lg border border-gray-300">
            <input type="text" id="user-input" placeholder="Ask about the weather or anything else..." class="flex-1 rounded-l-full p-4 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
            <button id="send-btn" class="bg-blue-600 text-white rounded-r-full p-4 px-6 hover:bg-blue-700 transition-colors">Send</button>
        </div>
        
        <div id="loading-indicator" class="mt-2 text-center text-gray-500 hidden">
            <svg class="animate-spin h-5 w-5 mr-3 inline text-blue-500" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Thinking...
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const loadingIndicator = document.getElementById('loading-indicator');

        
        const chatHistory = [];
        
        
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('chat-message', `chat-message-${sender}`, 'p-3', 'rounded-lg', 'max-w-[75%]');
            
            if (sender === 'user') {
                messageDiv.classList.add('bg-blue-500', 'text-white', 'self-end', 'ml-auto', 'rounded-br-none');
            } else {
                messageDiv.classList.add('bg-gray-200', 'text-gray-800', 'self-start', 'rounded-bl-none');
            }
            
            messageDiv.textContent = text;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight; 
        }

        
        async function sendMessage() {
            const userText = userInput.value.trim();
            if (!userText) return;

            addMessage(userText, 'user');
            userInput.value = '';
            
            
            chatHistory.push({ role: "user", parts: [{ text: userText }] });

            loadingIndicator.classList.remove('hidden');
            
            try {
                
                const payload = {
                    contents: chatHistory,
                    
                    tools: [{ "google_search": {} }],
                };

                // NOTE: To run this code on your device, you need to get your own API key.
                // Go to https://aistudio.google.com/app/apikey to get one and paste it below.
                const apiKey = "AIzaSyBeheH1hMrmdYDcb-XkHAt24a6J86JzZaM"; // Paste your API key here
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];
                
                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const assistantResponse = candidate.content.parts[0].text;
                    addMessage(assistantResponse, 'assistant');
                    
                    chatHistory.push({ role: "model", parts: [{ text: assistantResponse }] });
                } else {
                    addMessage("Sorry, I couldn't get a response. Please try again.", 'assistant');
                }

            } catch (error) {
                console.error("Error calling Gemini API:", error);
                addMessage("I'm sorry, an error occurred with the AI service. My apologies.", 'assistant');
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        
        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });

        
        document.addEventListener('DOMContentLoaded', () => {
            addMessage("Hello! I'm your AI assistant. I can answer general questions and get you the weather.", 'assistant');
        });
    </script>
</body>
</html>
